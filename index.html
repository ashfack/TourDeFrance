

<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Vigor+</title>
    <link rel="stylesheet" href="vigor.css">

<script>
// ********************************************************************* //
// *                                                                   * //
// *       "Vigor+" - Juin 2018                                        * //
// *                                                                   * //
// ********************************************************************* //
// *                                                                   * //
// *   Dominique Hourdequin - Juin 2018                                * //
// *   Projet N°2 - Type "Back-end"                                    * //
// *                                                                   * //
// *   Formation "Développeur Full Stack Javascript"                   * //
// *   Classe : "DIWJS08" - Printemps 2018                             * //
// *   IFOCOP - Paris XI                                               * //
// *                                                                   * //
// *   Contact à l'IFOCOP qui transmettra mes coordonnées sur demande  * //
// *   Responsable de formation                                        * //
// *   Madame Fabienne Thiry                                           * //
// *   mail : fthiry@ifocop.fr                                         * //
// *   Tel : 01-40-21-83-78                                            * //
// *                                                                   * //
// ********************************************************************* //
</script>

<style>
/* ------------------------------------------------------------ */
/* !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!  */
/*                                                              */
/*                    Polyfill pour Chrome                      */
/*                                                              */
/*   IMPORTANT !!!   Note de D. Hourdequin                      */
/*                                                              */
/*   Depuis la version de Chrome de janvier 2018, celui-ci      */
/*   n'autorise plus l'acces au CSSOM pour des raisons de       */
/*   violation du CORS (à cause de modules d'extensions qui     */
/*   faisaient de l'injection CSS)                              */
/*   Seul Chrome à réagi, et il semble que la modification ait  */
/*   entrainée le bug que nous rencontrons ici                  */ 
/*                                                              */
/*   Voila pourquoi J AI ETE OBLIGE DE METTRE LE FICHIER CSS    */
/*   DANS LE PROGRAMME PRINCIPAL (ET CA RESOUD EFFECTIVEMENT    */
/*   LE PROBLEME), MAIS JE N AIME PAS CETTE SOLUTION            */
/*                                                              */
/*  Uncaught DOMException: Failed to read the 'rules' property  */
/*  from 'CSSStyleSheet': Cannot access rules                   */
/*                                                              */
/* "Cannot access cssRules from local css file in Chrome 64"    */
/*                                                              */
/*  SOLUTIONS:                                                  */ 
/*  1. works when files are online/localhost                    */
/*  2. works with other browsers (i.e. Internet Explorer,       */   
/*  Microsoft Edge, Firefox)                                    */
/*  3. chrome --allow-file-access-from-files                    */                                        
/*                                                              */
/*  As of Chrome 64, new CORS rules are enforced for stylesheets*/
/*. You'll need to use a local development server to do local   */ 
/* testing of functionality that depends on the CSS Object Model*/
/* For details :                                                */
/* https://stackoverflow.com/questions/48753691/cannot-access   */
/* -cssrules-from-local-css-file-in-chrome/49160760#49160760    */
/*                                                              */
/* ------------------------------------------------------------ */

</style>
    <script src="variables.js"></script>
    <script src="spriteAncestor.js"></script>
    <script src="kbdMgr.js"></script>
    <script src="toolBox.js"></script>
    <script src="bipBip.js"></script>
    <script src="vilCoyote.js"></script>
    <script src="energyBall.js"></script>
    <script src="vautour.js"></script>
    <script src="backgroundMgr.js"></script>
    <script src="keyFrameMgr.js"></script>
    <script src="chiffres.js"></script>
    <script src="score.js"></script>
    
    <script>
      'use strict';

      var mainLoop = function(){

        // --------------------- Initialisations ------------------------
        // ------------------------------------------------------------
        // Initialisation des fonctions diverses dans ToolBox
        // ------------------------------------------------------------
        toolBox = new ToolBox();
        toolBox.getScreenSize();

        // ------------------------------------------------------------
        // Initialisation des fonds d'écran
        // ------------------------------------------------------------
        fondEcranSol = new ObjectFondEcran('6s', 'scrollBkgndSol','idFondEcranSol');
        fondEcranSol.initVar();
        
        fondEcranNuages = new ObjectFondEcran('3s','scrollBkgndNuages','idFondEcranNuages');
        fondEcranNuages.initVar();
        
        // ------------------------------------------------------------
        // Initialisation du Control-Panel et de ses boutons
        // ------------------------------------------------------------
        boiteControlPanel = document.getElementById('idBoiteControlPanel');
        boiteControlPanel.style.width = '100%';
        boiteControlPanel.style.height = '13%';
        
        cvCourtBtn = document.getElementById('idCVcourtBtn');
        cvLongBtn  = document.getElementById('idCVLongBtn');
        helpBtn = document.getElementById('idHelpBtn');
        helpScreen = document.getElementById('idHelpScreen');
        
        // ------------------------------------------------------------
        // Initialisation des messages de fin de partie
        // ------------------------------------------------------------
        imgVictoire = document.getElementById('idImgVictoire');
        imgPerdu = document.getElementById('idImgPerdu');
        imgRejouer = document.getElementById('idImgRejouer');

        // ------------------------------------------------------------
        // Polyfill pour Safari qui ne connait pas "RequestAnimationFrame"
        // ------------------------------------------------------------
        (function () {
          var lastTime = 0;
          var vendors = ['ms', 'moz', 'webkit', 'o'];
          for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];
          }
          if(!window.requestAnimationFrame)
            window.requestAnimationFrame = function (callback, element) {
              var currTime = new Date().getTime();
              var timeToCall = Math.max(0, 16 - (currTime - lastTime));
              var id = window.setTimeout(function () {
                callback(currTime + timeToCall);
              },
              timeToCall);
              lastTime = currTime + timeToCall;
              return id;
          };
          if(!window.cancelAnimationFrame)
            window.cancelAnimationFrame = function (id) {
              clearTimeout(id);
          };
        }());

        // ------------------------------------------------------------
        // Initialisation des targets - Les targets representent les compétences 
        // sous forme de Bip-Bip qu'il faut toucher pour révéler la compétence associée
        // ------------------------------------------------------------
        for (var i=0; i < dataBipBip.maxCompetences; i++){
          dataBipBip.bipBip[i] = new BipBip('idBoiteBipBip'+i,'idMasqueBipBip'+i,'idSpriteBipBip'+i);
          dataBipBip.bipBip[i].initVarMod();      
        }
        dataBipBip.targetActif = 0;
        dataBipBip.bipBip[dataBipBip.targetActif].AfficheTargetActif();
        
        // ------------------------------------------------------------
        // Initialisation de l'Objet "Vil-Coyote" commandé par l'utilsateur avec le clavier
        // ------------------------------------------------------------
        vilCoyote = new VilCoyote('idBoiteVilCoyote','idMasqueVilCoyote','idSpriteVilCoyote');
        vilCoyote.initVarMod();

        // ------------------------------------------------------------
        // Initialisation de l'Objet ennemi "Vautour" 
        // ------------------------------------------------------------
        dataVautours.vautour[0] = new Vautour('idBoiteVautour0','idMasqueVautour0','idSpriteVautour0');
        dataVautours.vautour[0].initVarMod();          
        
        // ------------------------------------------------------------
        // Initialisation du gestionnaire de KeyFrames (pour les animations)
        // ------------------------------------------------------------
        objectKeyFrame = new ObjectKeyFrame();      
        
        // ------------------------------------------------------------
        // --------------------- Main Program -------------------------
        // ------------------------------------------------------------
        // Lancement de l'Ecoute du clavier, et des divers écouteurs
        //                   and that's All Folks !!!
        //-------------------------------------------------------------
        window.addEventListener('keydown',vilCoyote.keyboardMgr.gereAppuiTouche.bind(vilCoyote.keyboardMgr));   
        window.addEventListener('keyup',vilCoyote.keyboardMgr.gereReleaseTouche.bind(vilCoyote.keyboardMgr));
        window.addEventListener('click',toolBox.openCV.bind(toolBox));
        window.addEventListener('resize',toolBox.refreshScreen.bind(toolBox));
      };
      // --------------------- Point d'entrée de l'application  ---------------------------
      // Lance l'éxecution du script après chargement et affichage du document  (Window)
      //-----------------------------------------------------------------------------------
      window.onload = mainLoop;      
  </script>

<!-- ******************************************************************* -->
<!--                               HTML                                  -->
<!-- ******************************************************************* -->
  </head>
  <body>      

    <!--  Arrière-Plan "Sol" en parallaxe   -->
    <div id="idFondEcranSol" class="clFondEcranSol"></div>

    <!--  Arrière-Plan "Nuages" en parallaxe   -->
    <div id="idFondEcranNuages" class="clFondEcranNuages"></div>

    <img id="idSpriteVie0" class="clSpriteVie" src="images/running-vil-coyote.png" alt="Sprite vie 'Vil-Coyote"/>
    <img id="idSpriteVie1" class="clSpriteVie" src="images/running-vil-coyote.png" alt="Sprite vie 'Vil-Coyote"/>
    <img id="idSpriteVie2" class="clSpriteVie" src="images/running-vil-coyote.png" alt="Sprite vie 'Vil-Coyote"/>

    <!-- Personnage Principal "Vil-Coyote"  -->
    <div id="idBoiteVilCoyote" class="clBoiteVilCoyote">
      <div id="idMasqueVilCoyote" class="clMasqueVilCoyote">
        <img id="idSpriteVilCoyote" class="clSpriteVilCoyote" src="images/vil-coyote-sur-module-start-01-04-Droite.png" alt="Sprite 'Vil-Coyote'"/>
      </div>
    </div>

    <!-- Boules d'énergie électrique tirées par Vil-Coyote -->
    <div id="idBoiteEnergyBall0" class="clBoiteEnergyBall">
      <div id="idMasqueEnergyBall0" class="clMasqueEnergyBall">
        <img id="idSpriteEnergyBall0" class="clSpriteEnergyBall" src="images/vil-coyote-energy-balls.png" alt="Sprite 'Boule d\'énergie'"/>
      </div>
    </div>

    <!-- Premier type d'ennemi : Le Vautour -->
    <div id="idBoiteVautour0" class="clBboiteVautour">
      <div id="idMasqueVautour0" class="clMasqueVautour">
        <img id="idSpriteVautour0" class="clSpriteVautour" src="images/vulture_face_one_flying-gauche.png" alt="Sprite 'Vautour'"/>
      </div>
    </div>

    <!-- Panneau de contrôle de bas d'écran -->
    <div id="idBoiteControlPanel" class="clBoiteControlPanel">
      <img id="idImgControlPanel" class="clImgControlPanel" src="images/controlPanel1024px-by-512px.png" alt="Sprite 'Container de bas d\'écran'"/>
    </div>

    <!-- Targets "Bip-Bip" que Vil-Coyote doit toucher -->
    <div id="idBoiteBipBip0" class="clBoiteBipBip">
      <div id="idMasqueBipBip0" class="clMasqueBipBip">
        <img id="idSpriteBipBip0" class="clSpriteBipBip" src="images/Bip-Bip.png" alt="Sprite 'Jeton Bip-Bip'"/>
      </div>
    </div>  
    
    <div id="idBoiteBipBip1" class="clBoiteBipBip">
      <div id="idMasqueBipBip1" class="clMasqueBipBip">
        <img id="idSpriteBipBip1" class="clSpriteBipBip" src="images/Bip-Bip.png" alt="Sprite 'Jeton Bip-Bip'"/>
      </div>
    </div>  
    
    <div id="idBoiteBipBip2" class="clBoiteBipBip">
      <div id="idMasqueBipBip2" class="clMasqueBipBip">
        <img id="idSpriteBipBip2" class="clSpriteBipBip" src="images/Bip-Bip.png" alt="Sprite 'Jeton Bip-Bip'"/>
      </div>
    </div>  
    
    <div id="idBoiteBipBip3" class="clBoiteBipBip">
      <div id="idMasqueBipBip3" class="clMasqueBipBip">
        <img id="idSpriteBipBip3" class="clSpriteBipBip" src="images/Bip-Bip.png" alt="Sprite 'Jeton Bip-Bip'"/>
      </div>
    </div>  
    
    <div id="idBoiteBipBip4" class="clBoiteBipBip">
      <div id="idMasqueBipBip4" class="clMasqueBipBip">
        <img id="idSpriteBipBip4" class="clSpriteBipBip" src="images/Bip-Bip.png" alt="Sprite 'Jeton Bip-Bip'"/>
      </div>
    </div>  
    
    <div id="idBoiteBipBip5" class="clBoiteBipBip">
      <div id="idMasqueBipBip5" class="clMasqueBipBip">
        <img id="idSpriteBipBip5" class="clSpriteBipBip" src="images/Bip-Bip.png" alt="Sprite 'Jeton Bip-Bip'"/>
      </div>
    </div>  
    
    <div id="idBoiteBipBip6" class="clBoiteBipBip">
      <div id="idMasqueBipBip6" class="clMasqueBipBip">
        <img id="idSpriteBipBip6" class="clSpriteBipBip" src="images/Bip-Bip.png" alt="Sprite 'Jeton Bip-Bip'"/>
      </div>
    </div>  
    
    <div id="idBoiteBipBip7" class="clBoiteBipBip">
      <div id="idMasqueBipBip7" class="clMasqueBipBip">
        <img id="idSpriteBipBip7" class="clSpriteBipBip" src="images/Bip-Bip.png" alt="Sprite 'Jeton Bip-Bip'"/>
      </div>
    </div>  
    
    <div id="idBoiteBipBip8" class="clBoiteBipBip">
      <div id="idMasqueBipBip8" class="clMasqueBipBip">
        <img id="idSpriteBipBip8" class="clSpriteBipBip" src="images/Bip-Bip.png" alt="Sprite 'Jeton Bip-Bip'"/>
      </div>
    </div>  
    
    <div id="idBoiteBipBip9" class="clBoiteBipBip">
      <div id="idMasqueBipBip9" class="clMasqueBipBip">
        <img id="idSpriteBipBip9" class="clSpriteBipBip" src="images/Bip-Bip.png" alt="Sprite 'Jeton Bip-Bip'"/>
      </div>
    </div>  
    
    <div id="idBoiteBipBip10" class="clBoiteBipBip">
      <div id="idMasqueBipBip10" class="clMasqueBipBip">
        <img id="idSpriteBipBip10" class="clSpriteBipBip" src="images/Bip-Bip.png" alt="Sprite 'Jeton Bip-Bip'"/>
      </div>
    </div>  


<!-- Chiffres 0 à 9 + "/" -->
    <div id="idBoiteChiffre0" class="clBoiteChiffre">
      <div id="idMasqueChiffre0" class="clMasqueChiffre">
        <img id="idSpriteChiffre0" class="clSpriteChiffre" src="images/LooneyTunesCouleur.png" alt="Emplacement du 1er chiffre du score"/>
      </div>
    </div>  
    
    <div id="idBoiteChiffre1" class="clBoiteChiffre">
      <div id="idMasqueChiffre1" class="clMasqueChiffre">
        <img id="idSpriteChiffre1" class="clSpriteChiffre" src="images/LooneyTunesCouleur.png" alt="Emplacement du 2eme chiffre du score'"/>
      </div>
    </div>  
    
    <div id="idBoiteChiffre2" class="clBoiteChiffre">
      <div id="idMasqueChiffre2" class="clMasqueChiffre">
        <img id="idSpriteChiffre2" class="clSpriteChiffre" src="images/LooneyTunesCouleur.png" alt="Emplacement du séparateur du score"/>
      </div>
    </div>  
    
    <div id="idBoiteChiffre3" class="clBoiteChiffre">
      <div id="idMasqueChiffre3" class="clMasqueChiffre">
        <img id="idSpriteChiffre3" class="clSpriteChiffre" src="images/LooneyTunesCouleur.png" alt="Emplacement du 3eme chiffre du score"/>
      </div>
    </div>  
    
    <div id="idBoiteChiffre4" class="clBoiteChiffre">
        <div id="idMasqueChiffre4" class="clMasqueChiffre">
          <img id="idSpriteChiffre4" class="clSpriteChiffre" src="images/LooneyTunesCouleur.png" alt="Emplacement du 4eme chiffre du score'"/>
        </div>
    </div>  


    <div id="idMasqueVictoire" class="clMasqueVictoire">
      <img id="idImgVictoire" class="clImgVictoire" src="images/victoire.png" alt="'Victoire'"/>
    </div>

    <div id="idMasquePerdu" class="clMasquePerdu">
      <img id="idImgPerdu" class="clImgPerdu" src="images/perdu.png" alt="'Perdu'"/>
    </div>

    <div id="idMasqueRejouer" class="clMasqueRejouer">
      <img id="idImgRejouer" class="clImgRejouer" src="images/rejouer.png" alt="'Rejouer'"/>
    </div>
  
    <img id="idCVcourtBtn" class="clCVcourtBtn" src="images/rolled-up.png" title="CV court" alt="Sprite du 'Parchemin'"/>
    <img id="idCVLongBtn" class="clCVLongBtn" src="images/brown-book.png" title="CV long" alt="Sprite du 'Grimoire'"/>
    <img id="idHelpBtn" class="clHelpBtn" src="images/help.png" title="Help button" alt="Sprite du bouton 'Help'"/>

    <div id="idHelpScreen" class="clHelpScreen">
      <img id="idHelpImg" class="clHelpImg" src="images/2048PX-BY-1536PX.png" title="Help screen" alt="Sprite de l\'écran 'Help'"/>
      <div id="idHelpText" class="clHelpText">
      </div>
    </div>
    <noscript>
      <p>Veuillez activer JavaScript</p>
    </noscript>    
  </body>
</html>